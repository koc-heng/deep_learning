<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>çŸ­æ–‡æœ¬åˆ†é¡é æ¸¬</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <h1>çŸ­æ–‡æœ¬åˆ†é¡é æ¸¬ç³»çµ±</h1>

  <!-- è¼¸å…¥å€ -->
  <div class="input-block">
    <input id="titleInput" placeholder="è«‹è¼¸å…¥æ–‡ç« æ¨™é¡Œ" />
    <button id="predictBtn">é æ¸¬åˆ†é¡</button>
  </div>

  <!-- çµæœå€ï¼ˆé æ¸¬å¾Œé¡¯ç¤ºï¼‰ -->
  <div id="resultBlock" class="hidden">
    <p>ğŸ” é æ¸¬çµæœï¼š<span id="predLabel"></span></p>
    <p>è«‹ç¢ºèªæ­¤åˆ†é¡æ˜¯å¦æ­£ç¢ºï¼š</p>
    <div id="suggestBtns">
      <button class="confirm" data-user-label="">ç¬¦åˆé æ¸¬</button>
      {% for label in labels %}
        <button class="suggest" data-user-label="{{ label }}">{{ label }}ï¼ˆ{{ label_chinese[label] }}ï¼‰</button>
      {% endfor %}
    </div>
  </div>

  <!-- JSå€å¡Š -->
  <script>
    const titleInput = document.getElementById('titleInput');
    const predictBtn = document.getElementById('predictBtn');
    const resultBlock = document.getElementById('resultBlock');
    const predLabelSpan = document.getElementById('predLabel');

    let currentPrediction = {
      model_label: "",
      confidence: 0
    };

    predictBtn.onclick = async () => {
      const title = titleInput.value.trim();
      if (!title) return alert('è«‹è¼¸å…¥æ¨™é¡Œ');

      const res = await fetch(`/api/model/prediction?title=${encodeURIComponent(title)}`);
      const data = await res.json();

      predLabelSpan.textContent = `${data.label}ï¼ˆ${data.label_chinese}ï¼‰`;
      predLabelSpan.dataset.modelLabel = data.label;
      predLabelSpan.dataset.confidence = data.confidence;

      currentPrediction.model_label = data.label;
      currentPrediction.confidence = data.confidence;

      resultBlock.classList.remove('hidden');
    };

    // ã€Œç¬¦åˆé æ¸¬ã€æŒ‰éˆ•
    document.addEventListener('click', async (e) => {
      if (e.target.classList.contains('confirm')) {
        const title = titleInput.value.trim();
        const modelLabel = currentPrediction.model_label;
        const confidence = currentPrediction.confidence;

        await fetch('/api/model/feedback', {
          method: 'POST',
          headers: {'Content-Type':'application/x-www-form-urlencoded'},
          body: new URLSearchParams({title, model_label: modelLabel, confidence})
        });
        alert('æ„Ÿè¬æ‚¨çš„å›é¥‹ï¼');
        resetPage();
      }

      // æ›´æ­£åˆ†é¡
      if (e.target.classList.contains('suggest')) {
        const title = titleInput.value.trim();
        const modelLabel = currentPrediction.model_label;
        const confidence = currentPrediction.confidence;
        const userLabel = e.target.dataset.userLabel;

        await fetch('/api/model/feedback', {
          method: 'POST',
          headers: {'Content-Type':'application/x-www-form-urlencoded'},
          body: new URLSearchParams({title, model_label: modelLabel, confidence, user_label: userLabel})
        });
        alert('ğŸ“¬ å›é¥‹å·²é€å‡º :D');
        resetPage();
      }
    });

    function resetPage() {
      titleInput.value = "";
      resultBlock.classList.add("hidden");
      predLabelSpan.textContent = "";
    }
  </script>
</body>
</html>


